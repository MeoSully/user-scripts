(function(a){var b={getDtsg(){try{return require("DTSGInitialData").token}catch(c){return document.getElementsByName("fb_dtsg")[0].value}},getUserId(){try{return require("CurrentUserInitialData").USER_ID}catch(c){return document.cookie.match(/c_user=([0-9]+)/)[1]}},data(){return this.fbDtsg=this.getDtsg(),this.userId=this.getUserId(),this},async request(c,d="GET",f,g=300){return new Promise(function(h){setTimeout(async function(){var j;j="GET"===d?await fetch(c):await fetch(c,{method:d,body:f}),h(j)},g)})},async getAccessToken(){var c=new FormData;c.append("fb_dtsg",this.fbDtsg),c.append("app_id","165907476854626"),c.append("redirect_uri","fbconnect://success"),c.append("display","page"),c.append("access_token",""),c.append("from_post",1),c.append("return_format","access_token"),c.append("domain",""),c.append("sso_device","ios"),c.append("__CONFIRM__",1),c.append("__user",this.userId);var d=await this.request("https://www.facebook.com/v1.0/dialog/oauth/confirm","POST",c,0),f=await d.text();return f.match(/access_token=(.*)(?=&expires_in)/)[1]},async getGroupsInfo(c){async function d(k){if(i=[...i,...k.data.map(n=>`${n.name} / ${n.id}`)],j=[...j,...k.data.map(n=>({name:n.name,id:n.id}))],!k.paging.next)return{groupsInfo:i,groupsInfoObj:j};var l=await f.request(k.paging.next),m=await l.json();return await d(m)}console.log("\u0110ang l\u1EA5y th\xF4ng tin c\xE1c nh\xF3m \u0111\xE3 tham gia...");var f=this,g=await this.request(`https://graph.facebook.com/v3.1/${this.userId}/groups?access_token=${c}&pretty=0&fields=name%2Cid&limit=50`),h=await g.json(),i=[],j=[];return await d(h)},leaveGroupIds(c){return new Promise(function(d){setTimeout(()=>{var g=prompt("Nh\u1EADp ID nh\xF3m kh\xF4ng mu\u1ED1n tho\xE1t, m\u1ED7i ID c\xE1ch nhau d\u1EA5u ph\u1EA9y(,)"),h=g?new Set([...g.split(",").map(i=>parseInt(i)),364997627165697]):new Set([364997627165697]);d(c.filter(({id:i})=>!h.has(parseInt(i))))},500)})},async leaveGroup(c){if(0>=c.length)return console.log("Xong");var d=new FormData;d.append("fb_dtsg",this.fbDtsg),d.append("confirmed",1),d.append("__user",this.userId),d.append("__a",1),d.append("prevent_readd","on"),d.append("__pc","PHASED:DEFAULT"),await this.request(`https://www.facebook.com/ajax/groups/membership/leave.php?group_id=${c[0].id}&ref=group_jump_header&dpr=1`,"POST",d),console.log(`Đã rời khỏi nhóm ${c[0].name}`),await this.leaveGroup(c.slice(1))},sortAndCopy(c){a(c.sort().map(d=>d).join("\n")),console.log("\u0110\xE3 sao ch\xE9p to\xE0n b\u1ED9 th\xF4ng tin nh\xF3m v\xE0o b\u1ED9 nh\u1EDB t\u1EA1m")},async run(){var c=await this.getAccessToken(),{groupsInfo:d,groupsInfoObj:f}=await this.getGroupsInfo(c);this.sortAndCopy(d);var g=await this.leaveGroupIds(f);await this.leaveGroup(g)}};b.data().run()})(window.copy);
